###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         25/Aug/2018  23:10:04 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\Source\enddevice.c             #
#    Command line       =  -f F:\work\iot-hardware\logger\logger\Projects\zst #
#                          ack\Samples\GenericApp\CC2530DB\..\..\..\Tools\CC2 #
#                          530DB\f8wEndev.cfg (-DCPU32MHZ -DROOT=__near_func  #
#                          -DMAC_CFG_TX_DATA_MAX=3 -DMAC_CFG_TX_MAX=6         #
#                          -DMAC_CFG_RX_MAX=3) -f F:\work\iot-hardware\logger #
#                          \logger\Projects\zstack\Samples\GenericApp\CC2530D #
#                          B\..\..\..\Tools\CC2530DB\f8wConfig.cfg            #
#                          (-DZIGBEEPRO -DSECURE=0 -DZG_SECURE_DYNAMIC=0      #
#                          -DREFLECTOR -DDEFAULT_CHANLIST=0x00000800          #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 F:\work\iot-hardware\logger #
#                          \logger\Projects\zstack\Samples\GenericApp\Source\ #
#                          enddevice.c -D NWK_AUTO_POLL -D ZTOOL_P1 -D        #
#                          MT_TASK -D MT_SYS_FUNC -D MT_ZDO_FUNC -D           #
#                          LCD_SUPPORTED=DEBUG -D xPOWER_SAVING -lC           #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\EndDeviceEB\List\     #
#                          -lA F:\work\iot-hardware\logger\logger\Projects\zs #
#                          tack\Samples\GenericApp\CC2530DB\EndDeviceEB\List\ #
#                           --diag_suppress Pe001,Pa010 -o                    #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\EndDeviceEB\Obj\ -e   #
#                          --no_cse --no_unroll --no_inline --no_code_motion  #
#                          --no_tbaa --debug --core=plain --dptr=16,1         #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I F:\work\iot-hardware\logger\logger\Projects\zst #
#                          ack\Samples\GenericApp\CC2530DB\ -I                #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\..\Source\ -I         #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\..\..\..\ZMain\TI2530 #
#                          DB\ -I F:\work\iot-hardware\logger\logger\Projects #
#                          \zstack\Samples\GenericApp\CC2530DB\..\..\..\..\.. #
#                          \Components\hal\include\ -I                        #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\..\..\..\..\..\Compon #
#                          ents\hal\target\CC2530EB\ -I                       #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\..\..\..\..\..\Compon #
#                          ents\mac\include\ -I F:\work\iot-hardware\logger\l #
#                          ogger\Projects\zstack\Samples\GenericApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\mac\high_level\ -I       #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\..\..\..\..\..\Compon #
#                          ents\mac\low_level\srf04\ -I                       #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\..\..\..\..\..\Compon #
#                          ents\mac\low_level\srf04\single_chip\ -I           #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\..\..\..\..\..\Compon #
#                          ents\mt\ -I F:\work\iot-hardware\logger\logger\Pro #
#                          jects\zstack\Samples\GenericApp\CC2530DB\..\..\..\ #
#                          ..\..\Components\osal\include\ -I                  #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\..\..\..\..\..\Compon #
#                          ents\services\saddr\ -I F:\work\iot-hardware\logge #
#                          r\logger\Projects\zstack\Samples\GenericApp\CC2530 #
#                          DB\..\..\..\..\..\Components\services\sdata\ -I    #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\..\..\..\..\..\Compon #
#                          ents\stack\af\ -I F:\work\iot-hardware\logger\logg #
#                          er\Projects\zstack\Samples\GenericApp\CC2530DB\..\ #
#                          ..\..\..\..\Components\stack\nwk\ -I               #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\..\..\..\..\..\Compon #
#                          ents\stack\sapi\ -I F:\work\iot-hardware\logger\lo #
#                          gger\Projects\zstack\Samples\GenericApp\CC2530DB\. #
#                          .\..\..\..\..\Components\stack\sec\ -I             #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\..\..\..\..\..\Compon #
#                          ents\stack\sys\ -I F:\work\iot-hardware\logger\log #
#                          ger\Projects\zstack\Samples\GenericApp\CC2530DB\.. #
#                          \..\..\..\..\Components\stack\zdo\ -I              #
#                          F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\..\..\..\..\..\Compon #
#                          ents\zmac\ -I F:\work\iot-hardware\logger\logger\P #
#                          rojects\zstack\Samples\GenericApp\CC2530DB\..\..\. #
#                          .\..\..\Components\zmac\f8w\ -Ol                   #
#                          --require_prototypes                               #
#    List file          =  F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\EndDeviceEB\List\endd #
#                          evice.lst                                          #
#    Object file        =  F:\work\iot-hardware\logger\logger\Projects\zstack #
#                          \Samples\GenericApp\CC2530DB\EndDeviceEB\Obj\endde #
#                          vice.r51                                           #
#                                                                             #
#                                                                             #
###############################################################################

F:\work\iot-hardware\logger\logger\Projects\zstack\Samples\GenericApp\Source\enddevice.c
      1          /******************************************************************************
      2            Filename:       GenericApp.c
      3            Revised:        $Date: 2012-03-07 01:04:58 -0800 (Wed, 07 Mar 2012) $
      4            Revision:       $Revision: 29656 $
      5          
      6            Description:    Generic Application (no Profile).
      7          
      8          
      9            Copyright 2004-2012 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License"). You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product. Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          ******************************************************************************/
     39          
     40          /*********************************************************************
     41            This application isn't intended to do anything useful, it is
     42            intended to be a simple example of an application's structure.
     43          
     44            This application sends "Hello World" to another "Generic"
     45            application every 5 seconds.  The application will also
     46            receives "Hello World" packets.
     47          
     48            The "Hello World" messages are sent/received as MSG type message.
     49          
     50            This applications doesn't have a profile, so it handles everything
     51            directly - itself.
     52          
     53            Key control:
     54              SW1:
     55              SW2:  initiates end device binding
     56              SW3:
     57              SW4:  initiates a match description request
     58          *********************************************************************/
     59          
     60          /*********************************************************************
     61           * INCLUDES
     62           */
     63          #include <ioCC2530.h>

   \                                 In  segment SFR_AN, at 0x80
   \   union <unnamed> volatile __sfr _A_P0
   \                     _A_P0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x88
   \   union <unnamed> volatile __sfr _A_TCON
   \                     _A_TCON:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x89
   \   unsigned char volatile __sfr P0IFG
   \                     P0IFG:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x8c
   \   unsigned char volatile __sfr PICTL
   \                     PICTL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xab
   \   unsigned char volatile __sfr P0IEN
   \                     P0IEN:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xb6
   \   unsigned char volatile __sfr ADCCON3
   \                     ADCCON3:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xb8
   \   union <unnamed> volatile __sfr _A_IEN1
   \                     _A_IEN1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xba
   \   unsigned char volatile __sfr ADCL
   \                     ADCL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xbb
   \   unsigned char volatile __sfr ADCH
   \                     ADCH:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc0
   \   union <unnamed> volatile __sfr _A_IRCON
   \                     _A_IRCON:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc9
   \   unsigned char volatile __sfr WDCTL
   \                     WDCTL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf2
   \   unsigned char volatile __sfr APCFG
   \                     APCFG:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf3
   \   unsigned char volatile __sfr P0SEL
   \                     P0SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfd
   \   unsigned char volatile __sfr P0DIR
   \                     P0DIR:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1
     64          
     65          #include "OSAL.h"
     66          #include "AF.h"
     67          #include "ZDApp.h"
     68          #include "ZDObject.h"
     69          #include "ZDProfile.h"
     70          #include "OSAL_Nv.h"
     71          
     72          #include "GenericApp.h"
     73          #include "DebugTrace.h"
     74          
     75          #if !defined( WIN32 )
     76            #include "OnBoard.h"
     77          #endif
     78          
     79          /* HAL */
     80          #include "hal_lcd.h"
     81          #include "hal_led.h"
     82          #include "hal_key.h"
     83          #include "hal_uart.h"
     84          #include "hal_adc.h"
     85          
     86          #include "DHT11.h"
     87          
     88          /* RTOS */
     89          #if defined( IAR_ARMCM3_LM )
     90          #include "RTOS_App.h"
     91          #endif  
     92          
     93          /*********************************************************************
     94           * MACROS
     95           */
     96          
     97          /*********************************************************************
     98           * CONSTANTS
     99           */
    100          
    101          /*********************************************************************
    102           * TYPEDEFS
    103           */
    104          
    105          /*********************************************************************
    106           * GLOBAL VARIABLES
    107           */
    108          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    109          const cId_t GenericApp_ClusterList[GENERICAPP_MAX_CLUSTERS] =
   \                     GenericApp_ClusterList:
   \   000000   0100         DW 1
   \   000002   0200         DW 2
    110          {
    111            GENERICAPP_HTID,
    112            GENERICAPP_RSPID
    113          
    114          };
    115          

   \                                 In  segment XDATA_ROM_C, align 1
    116          const SimpleDescriptionFormat_t GenericApp_SimpleDesc =
   \                     GenericApp_SimpleDesc:
   \   000000   0A           DB 10
   \   000001   040F         DW 3844
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   02           DB 2
   \   000007   ....         DW GenericApp_ClusterList
   \   000009   02           DB 2
   \   00000A   ....         DW GenericApp_ClusterList
    117          {
    118            GENERICAPP_ENDPOINT,              //  int Endpoint;
    119            GENERICAPP_PROFID,                //  uint16 AppProfId[2];
    120            GENERICAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    121            GENERICAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    122            GENERICAPP_FLAGS,                 //  int   AppFlags:4;
    123            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    124            (cId_t *)GenericApp_ClusterList,  //  byte *pAppInClusterList;
    125            GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    126            (cId_t *)GenericApp_ClusterList   //  byte *pAppInClusterList;
    127          };
    128          
    129          // This is the Endpoint/Interface description.  It is defined here, but
    130          // filled-in in GenericApp_Init().  Another way to go would be to fill
    131          // in the structure here and make it a "const" (in code space).  The
    132          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    133          endPointDesc_t GenericApp_epDesc;
   \                     GenericApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    134          
    135          /*********************************************************************
    136           * EXTERNAL VARIABLES
    137           */
    138          
    139          /*********************************************************************
    140           * EXTERNAL FUNCTIONS
    141           */
    142          
    143          /*********************************************************************
    144           * LOCAL VARIABLES
    145           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    146          byte GenericApp_TaskID;   // Task ID for internal task/event processing
   \                     GenericApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    147                                    // This variable will be received when
    148                                    // GenericApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    149          devStates_t GenericApp_NwkState;
   \                     GenericApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    150          
    151          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    152          byte GenericApp_TransID;  // This is the unique message ID (counter)
   \                     GenericApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    153          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    154          afAddrType_t GenericApp_DstAddr;
   \                     GenericApp_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    155          
    156          #define MAX_COLLECT_COUNT  10//10 5分钟发一次 120*GENERICAPP_SEND_MSG_TIMEOUT(0.5MIN)

   \                                 In  segment XDATA_I, align 1, keep-with-next
    157          int collect_count =MAX_COLLECT_COUNT-1; //启动时候先发一次
   \                     collect_count:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for collect_count>`
   \   000002                REQUIRE __INIT_XDATA_I
    158          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    159          byte send_timeout_count =0xff;  //一次5秒,ff 为无效值，不检测
   \                     send_timeout_count:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for send_timeout_count>`
   \   000001                REQUIRE __INIT_XDATA_I
    160          
    161          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    162          byte isr_on =0x0;  
   \                     isr_on:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    163          
    164          #define PACKET_SEND_TIMEOUT_COUNT 2 //30秒超时检查
    165          
    166          
    167          
    168          
    169          
    170          /*********************************************************************
    171           * LOCAL FUNCTIONS
    172           */
    173          static void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    174          static void GenericApp_HandleKeys( byte shift, byte keys );
    175          static void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    176          static void GenericApp_SendTheMessage( void );
    177          __interrupt void P0_ISR(void) ;
    178          
    179          #if defined( IAR_ARMCM3_LM )
    180          static void GenericApp_ProcessRtosMessage( void );
    181          #endif
    182          
    183          /****************************************************************************
    184          * 名    称: P0_ISR(void) 中断处理函数 
    185          * 描    述: #pragma vector = 中断向量，紧接着是中断处理程序
    186          ****************************************************************************/
    187          #pragma vector = P0INT_VECTOR    

   \                                 In  segment NEAR_CODE, align 1, keep-with-next
    188          __interrupt void P0_ISR(void) 
   \                     P0_ISR:
    189          { 
   \   000000   C0E0         PUSH    A
   \   000002   74F2         MOV     A,#-0xe
   \   000004   12....       LCALL   ?INTERRUPT_ENTER_XSP
   \   000007                ; Saved register size: 14
   \   000007                ; Auto size: 0
    190          //    DelayMS(10);     //延时去抖
    191          //    LED1 = ~LED1;    //改变LED1状态
    192          
    193          //	GenericApp_SendTheMessage();
    194          
    195          
    196              P0IFG = 0;       //清中断标志 
   \   000007   758900       MOV     0x89,#0x0
    197              P0IF = 0;        //清中断标志 
   \   00000A   C2C5         CLR     0xc0.5
    198          	if(isr_on)
   \   00000C   90....       MOV     DPTR,#isr_on
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   7028         JNZ     ??P0_ISR_0
    199          	{
    200          		return;
    201          	}
    202          
    203          
    204          
    205          
    206          	//启动1s定时器
    207          	osal_start_timerEx( GenericApp_TaskID,
    208          						GENERICAPP_GPIO_MSG_EVT,
    209          						1000 );
   \   000012                ; Setup parameters for call to function osal_start_timerEx
   \   000012   7CE8         MOV     R4,#-0x18
   \   000014   7D03         MOV     R5,#0x3
   \   000016   7A03         MOV     R2,#0x3
   \   000018   7B00         MOV     R3,#0x0
   \   00001A   90....       MOV     DPTR,#GenericApp_TaskID
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F9           MOV     R1,A
   \   00001F   12....       LCALL   ??osal_start_timerEx?relay
   \   000022   E9           MOV     A,R1
    210          	//打开中断控制变量，以免重复进入
    211          	isr_on = 1;
   \   000023   90....       MOV     DPTR,#isr_on
   \   000026   7401         MOV     A,#0x1
   \   000028   F0           MOVX    @DPTR,A
    212          	//启动1min定时器关闭中断，避免重复进入
    213          	osal_start_timerEx( GenericApp_TaskID,
    214          						GENERICAPP_ISR_ON_EVT,
    215          						GENERICAPP_ISR_TIMEOUT );
   \   000029                ; Setup parameters for call to function osal_start_timerEx
   \   000029   7C60         MOV     R4,#0x60
   \   00002B   7DEA         MOV     R5,#-0x16
   \   00002D   7A04         MOV     R2,#0x4
   \   00002F   7B00         MOV     R3,#0x0
   \   000031   90....       MOV     DPTR,#GenericApp_TaskID
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F9           MOV     R1,A
   \   000036   12....       LCALL   ??osal_start_timerEx?relay
   \   000039   E9           MOV     A,R1
    216          
    217          	
    218              
    219          } 
   \                     ??P0_ISR_0:
   \   00003A   7F01         MOV     R7,#0x1
   \   00003C   02....       LJMP    ?INTERRUPT_LEAVE_XSP
   \   00003F                REQUIRE P0IFG
   \   00003F                REQUIRE _A_IRCON
    220          
    221          
    222          /*********************************************************************
    223           * NETWORK LAYER CALLBACKS
    224           */
    225          
    226          /*********************************************************************
    227           * PUBLIC FUNCTIONS
    228           */
    229          
    230          /*********************************************************************
    231           * @fn      GenericApp_Init
    232           *
    233           * @brief   Initialization function for the Generic App Task.
    234           *          This is called during initialization and should contain
    235           *          any application specific initialization (ie. hardware
    236           *          initialization/setup, table initialization, power up
    237           *          notificaiton ... ).
    238           *
    239           * @param   task_id - the ID assigned by OSAL.  This ID should be
    240           *                    used to send messages and set timers.
    241           *
    242           * @return  none
    243           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    244          void GenericApp_Init( uint8 task_id )
   \                     GenericApp_Init:
    245          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    246            GenericApp_TaskID = task_id;
   \   000007   90....       MOV     DPTR,#GenericApp_TaskID
   \   00000A   F0           MOVX    @DPTR,A
    247            GenericApp_NwkState = DEV_INIT;
   \   00000B   90....       MOV     DPTR,#GenericApp_NwkState
   \   00000E   7401         MOV     A,#0x1
   \   000010   F0           MOVX    @DPTR,A
    248            GenericApp_TransID = 0;
   \   000011   90....       MOV     DPTR,#GenericApp_TransID
   \   000014   7400         MOV     A,#0x0
   \   000016   F0           MOVX    @DPTR,A
    249          
    250            //add by guojun
    251            
    252            APCFG |= 0x40;   //P0.6为ADC 输入，检查电池电压
   \   000017   43F240       ORL     0xf2,#0x40
    253            P0SEL |= 0x40; 
   \   00001A   43F340       ORL     0xf3,#0x40
    254            P0DIR	&= ~0x40;	
   \   00001D   53FDBF       ANL     0xfd,#0xbf
    255          
    256          
    257          
    258            //init IR interrupt , P0.5
    259          
    260          //  P2INP |= 0x20;    //初始化PO为下拉
    261            P0DIR &= ~0x20;  //P0.5为输入 红外传感
   \   000020   53FDDF       ANL     0xfd,#0xdf
    262          
    263            P0IEN |= 0x20;	// P0.5 设置为中断方式 1：中断使能
   \   000023   43AB20       ORL     0xab,#0x20
    264            PICTL |= 0x00;	//上升沿触发	
   \   000026   858C8C       MOV     0x8c,0x8c
    265            IEN1 |= 0x20;    //允许P0口中断; 
   \   000029   D2BD         SETB    0xb8.5
    266            P0IFG = 0x00;    //初始化中断标志位
   \   00002B   758900       MOV     0x89,#0x0
    267            EA = 1;		   //打开总中断
   \   00002E   D2AF         SETB    0xa8.7
    268          
    269          //led p1.0/1.1 拉高点亮	
    270            P1DIR |= 0x03; //配置IO口方向
   \   000030   43FE03       ORL     0xfe,#0x3
    271          
    272            P1_0 = 1;
   \   000033   D290         SETB    0x90.0
    273            P1_1 = 1;
   \   000035   D291         SETB    0x90.1
    274          
    275            
    276            // 先读一遍，避免取到0值；
    277          
    278            DHT11();
   \   000037                ; Setup parameters for call to function DHT11
   \   000037   12....       LCALL   ??DHT11?relay
    279          
    280          
    281            //end add
    282          
    283          
    284          
    285          
    286            // Device hardware initialization can be added here or in main() (Zmain.c).
    287            // If the hardware is application specific - add it here.
    288            // If the hardware is other parts of the device add it in main().
    289          
    290            GenericApp_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   00003A   90....       MOV     DPTR,#GenericApp_DstAddr + 8
   \   00003D   7402         MOV     A,#0x2
   \   00003F   F0           MOVX    @DPTR,A
    291            GenericApp_DstAddr.endPoint = GENERICAPP_ENDPOINT;
   \   000040   90....       MOV     DPTR,#GenericApp_DstAddr + 9
   \   000043   740A         MOV     A,#0xa
   \   000045   F0           MOVX    @DPTR,A
    292            GenericApp_DstAddr.addr.shortAddr = 0x0000;
   \   000046   90....       MOV     DPTR,#GenericApp_DstAddr
   \   000049   7400         MOV     A,#0x0
   \   00004B   F0           MOVX    @DPTR,A
   \   00004C   A3           INC     DPTR
   \   00004D   7400         MOV     A,#0x0
   \   00004F   F0           MOVX    @DPTR,A
    293          
    294            // Fill out the endpoint description.
    295            GenericApp_epDesc.endPoint = GENERICAPP_ENDPOINT;
   \   000050   90....       MOV     DPTR,#GenericApp_epDesc
   \   000053   740A         MOV     A,#0xa
   \   000055   F0           MOVX    @DPTR,A
    296            GenericApp_epDesc.task_id = &GenericApp_TaskID;
   \   000056   90....       MOV     DPTR,#GenericApp_epDesc + 1
   \   000059   74..         MOV     A,#GenericApp_TaskID & 0xff
   \   00005B   F0           MOVX    @DPTR,A
   \   00005C   A3           INC     DPTR
   \   00005D   74..         MOV     A,#(GenericApp_TaskID >> 8) & 0xff
   \   00005F   F0           MOVX    @DPTR,A
    297            GenericApp_epDesc.simpleDesc
    298                      = (SimpleDescriptionFormat_t *)&GenericApp_SimpleDesc;
   \   000060   90....       MOV     DPTR,#GenericApp_epDesc + 3
   \   000063   74..         MOV     A,#GenericApp_SimpleDesc & 0xff
   \   000065   F0           MOVX    @DPTR,A
   \   000066   A3           INC     DPTR
   \   000067   74..         MOV     A,#(GenericApp_SimpleDesc >> 8) & 0xff
   \   000069   F0           MOVX    @DPTR,A
    299            GenericApp_epDesc.latencyReq = noLatencyReqs;
   \   00006A   90....       MOV     DPTR,#GenericApp_epDesc + 5
   \   00006D   7400         MOV     A,#0x0
   \   00006F   F0           MOVX    @DPTR,A
    300          
    301            // Register the endpoint description with the AF
    302            afRegister( &GenericApp_epDesc );
   \   000070                ; Setup parameters for call to function afRegister
   \   000070   7A..         MOV     R2,#GenericApp_epDesc & 0xff
   \   000072   7B..         MOV     R3,#(GenericApp_epDesc >> 8) & 0xff
   \   000074   12....       LCALL   ??afRegister?relay
   \   000077   E9           MOV     A,R1
    303          
    304            // Register for all key events - This app will handle all key events
    305            RegisterForKeys( GenericApp_TaskID );
   \   000078                ; Setup parameters for call to function RegisterForKeys
   \   000078   90....       MOV     DPTR,#GenericApp_TaskID
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   F9           MOV     R1,A
   \   00007D   12....       LCALL   ??RegisterForKeys?relay
   \   000080   E9           MOV     A,R1
    306          
    307            // Update the display
    308          #if defined ( LCD_SUPPORTED )
    309            HalLcdWriteString( "GenericApp", HAL_LCD_LINE_1 );
   \   000081                ; Setup parameters for call to function HalLcdWriteString
   \   000081   7901         MOV     R1,#0x1
   \   000083   7A..         MOV     R2,#`?<Constant "GenericApp">` & 0xff
   \   000085   7B..         MOV     R3,#(`?<Constant "GenericApp">` >> 8) & 0xff
   \   000087   12....       LCALL   ??HalLcdWriteString?relay
    310          #endif
    311          
    312            ZDO_RegisterForZDOMsg( GenericApp_TaskID, End_Device_Bind_rsp );
   \   00008A                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00008A   7A20         MOV     R2,#0x20
   \   00008C   7B80         MOV     R3,#-0x80
   \   00008E   90....       MOV     DPTR,#GenericApp_TaskID
   \   000091   E0           MOVX    A,@DPTR
   \   000092   F9           MOV     R1,A
   \   000093   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   000096   E9           MOV     A,R1
    313            ZDO_RegisterForZDOMsg( GenericApp_TaskID, Match_Desc_rsp );
   \   000097                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000097   7A06         MOV     R2,#0x6
   \   000099   7B80         MOV     R3,#-0x80
   \   00009B   90....       MOV     DPTR,#GenericApp_TaskID
   \   00009E   E0           MOVX    A,@DPTR
   \   00009F   F9           MOV     R1,A
   \   0000A0   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   \   0000A3   E9           MOV     A,R1
    314          
    315          #if defined( IAR_ARMCM3_LM )
    316            // Register this task with RTOS task initiator
    317            RTOS_RegisterApp( task_id, GENERICAPP_RTOS_MSG_EVT );
    318          #endif
    319          
    320          //启动定时器
    321          osal_start_timerEx( GenericApp_TaskID,
    322          					GENERICAPP_SEND_MSG_EVT,
    323          					GENERICAPP_SEND_MSG_TIMEOUT );
   \   0000A4                ; Setup parameters for call to function osal_start_timerEx
   \   0000A4   7C30         MOV     R4,#0x30
   \   0000A6   7D75         MOV     R5,#0x75
   \   0000A8   7A01         MOV     R2,#0x1
   \   0000AA   7B00         MOV     R3,#0x0
   \   0000AC   90....       MOV     DPTR,#GenericApp_TaskID
   \   0000AF   E0           MOVX    A,@DPTR
   \   0000B0   F9           MOV     R1,A
   \   0000B1   12....       LCALL   ??osal_start_timerEx?relay
   \   0000B4   E9           MOV     A,R1
    324          
    325          }
   \   0000B5   7F01         MOV     R7,#0x1
   \   0000B7   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   0000BA                REQUIRE APCFG
   \   0000BA                REQUIRE P0SEL
   \   0000BA                REQUIRE P0DIR
   \   0000BA                REQUIRE P0IEN
   \   0000BA                REQUIRE PICTL
   \   0000BA                REQUIRE _A_IEN1
   \   0000BA                REQUIRE P0IFG
   \   0000BA                REQUIRE _A_IEN0
   \   0000BA                REQUIRE P1DIR
   \   0000BA                REQUIRE _A_P1
    326          
    327          /*********************************************************************
    328           * @fn      GenericApp_ProcessEvent
    329           *
    330           * @brief   Generic Application Task event processor.  This function
    331           *          is called to process all events for the task.  Events
    332           *          include timers, messages and any other user defined events.
    333           *
    334           * @param   task_id  - The OSAL assigned task ID.
    335           * @param   events - events to process.  This is a bit map and can
    336           *                   contain more than one event.
    337           *
    338           * @return  none
    339           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    340          uint16 GenericApp_ProcessEvent( uint8 task_id, uint16 events )
   \                     GenericApp_ProcessEvent:
    341          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    342            afIncomingMSGPacket_t *MSGpkt;
    343            afDataConfirm_t *afDataConfirm;
    344          
    345            // Data Confirmation message fields
    346            byte sentEP;
    347            ZStatus_t sentStatus;
    348            byte sentTransID;       // This should match the value sent
    349            (void)task_id;  // Intentionally unreferenced parameter
    350            if ( events & SYS_EVENT_MSG )
   \   000009   EE           MOV     A,R6
   \   00000A   5400         ANL     A,#0x0
   \   00000C   F8           MOV     R0,A
   \   00000D   EF           MOV     A,R7
   \   00000E   5480         ANL     A,#0x80
   \   000010   F9           MOV     R1,A
   \   000011   E8           MOV     A,R0
   \   000012   49           ORL     A,R1
   \   000013   7003         JNZ     $+5
   \   000015   02....       LJMP    ??GenericApp_ProcessEvent_0 & 0xFFFF
    351            {
    352              MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000018                ; Setup parameters for call to function osal_msg_receive
   \   000018   90....       MOV     DPTR,#GenericApp_TaskID
   \   00001B   E0           MOVX    A,@DPTR
   \   00001C   F9           MOV     R1,A
   \   00001D   12....       LCALL   ??osal_msg_receive?relay
   \   000020   8A..         MOV     ?V0 + 2,R2
   \   000022   8B..         MOV     ?V0 + 3,R3
   \   000024   85....       MOV     ?V0 + 0,?V0 + 2
   \   000027   85....       MOV     ?V0 + 1,?V0 + 3
   \   00002A   801A         SJMP    ??GenericApp_ProcessEvent_1
    353              while ( MSGpkt )
    354              {
    355                switch ( MSGpkt->hdr.event )
    356                {
    357                  case ZDO_CB_MSG:
    358                    GenericApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    359                    break;
    360          
    361                  case KEY_CHANGE:
    362                    GenericApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    363                    break;
    364          
    365                  case AF_DATA_CONFIRM_CMD:
    366                    // This message is received as a confirmation of a data packet sent.
    367                    // The status is of ZStatus_t type [defined in ZComDef.h]
    368                    // The message fields are defined in AF.h
    369                    afDataConfirm = (afDataConfirm_t *)MSGpkt;
    370                    sentEP = afDataConfirm->endpoint;
    371                    sentStatus = afDataConfirm->hdr.status;
    372                    sentTransID = afDataConfirm->transID;
    373                    (void)sentEP;
    374                    (void)sentTransID;
    375          
    376                    // Action taken when confirmation is received.
    377                    if ( sentStatus != ZSuccess )
    378                    {
    379                      // The data wasn't delivered -- Do something
    380                    }
    381                    break;
    382          
    383                  case AF_INCOMING_MSG_CMD:
    384                    GenericApp_MessageMSGCB( MSGpkt );
    385                    break;
    386          
    387                  case ZDO_STATE_CHANGE:
    388                    GenericApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
    389                    if ( (GenericApp_NwkState == DEV_ZB_COORD)
    390                        || (GenericApp_NwkState == DEV_ROUTER)
    391                        || (GenericApp_NwkState == DEV_END_DEVICE) )
    392                    {
    393                      // Start sending "the" message in a regular interval.
    394                      osal_start_timerEx( GenericApp_TaskID,
    395                                          GENERICAPP_SEND_MSG_EVT,
    396                                          GENERICAPP_SEND_MSG_TIMEOUT );
    397                    }
    398                    break;
    399          
    400                  default:
    401                    break;
    402                }
    403          
    404                // Release the memory
    405                osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??GenericApp_ProcessEvent_2:
   \   00002C                ; Setup parameters for call to function osal_msg_deallocate
   \   00002C   AA..         MOV     R2,?V0 + 0
   \   00002E   AB..         MOV     R3,?V0 + 1
   \   000030   12....       LCALL   ??osal_msg_deallocate?relay
   \   000033   E9           MOV     A,R1
    406          
    407                // Next
    408                MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000034                ; Setup parameters for call to function osal_msg_receive
   \   000034   90....       MOV     DPTR,#GenericApp_TaskID
   \   000037   E0           MOVX    A,@DPTR
   \   000038   F9           MOV     R1,A
   \   000039   12....       LCALL   ??osal_msg_receive?relay
   \   00003C   8A..         MOV     ?V0 + 2,R2
   \   00003E   8B..         MOV     ?V0 + 3,R3
   \   000040   85....       MOV     ?V0 + 0,?V0 + 2
   \   000043   85....       MOV     ?V0 + 1,?V0 + 3
   \                     ??GenericApp_ProcessEvent_1:
   \   000046   E5..         MOV     A,?V0 + 0
   \   000048   45..         ORL     A,?V0 + 1
   \   00004A   7003         JNZ     $+5
   \   00004C   02....       LJMP    ??GenericApp_ProcessEvent_3 & 0xFFFF
   \   00004F   85..82       MOV     DPL,?V0 + 0
   \   000052   85..83       MOV     DPH,?V0 + 1
   \   000055   E0           MOVX    A,@DPTR
   \   000056   24E6         ADD     A,#-0x1a
   \   000058   6052         JZ      ??GenericApp_ProcessEvent_4
   \   00005A   245A         ADD     A,#0x5a
   \   00005C   6017         JZ      ??GenericApp_ProcessEvent_5
   \   00005E   24EF         ADD     A,#-0x11
   \   000060   6054         JZ      ??GenericApp_ProcessEvent_6
   \   000062   24FE         ADD     A,#-0x2
   \   000064   6006         JZ      ??GenericApp_ProcessEvent_7
   \   000066   24D6         ADD     A,#-0x2a
   \   000068   6025         JZ      ??GenericApp_ProcessEvent_8
   \   00006A   80C0         SJMP    ??GenericApp_ProcessEvent_2
   \                     ??GenericApp_ProcessEvent_7:
   \   00006C                ; Setup parameters for call to function GenericApp_ProcessZDOMsgs
   \   00006C   AA..         MOV     R2,?V0 + 0
   \   00006E   AB..         MOV     R3,?V0 + 1
   \   000070   12....       LCALL   ??GenericApp_ProcessZDOMsgs?relay
   \   000073   80B7         SJMP    ??GenericApp_ProcessEvent_2
   \                     ??GenericApp_ProcessEvent_5:
   \   000075                ; Setup parameters for call to function GenericApp_HandleKeys
   \   000075   85..82       MOV     DPL,?V0 + 0
   \   000078   85..83       MOV     DPH,?V0 + 1
   \   00007B   A3           INC     DPTR
   \   00007C   A3           INC     DPTR
   \   00007D   A3           INC     DPTR
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   FA           MOV     R2,A
   \   000080   85..82       MOV     DPL,?V0 + 0
   \   000083   85..83       MOV     DPH,?V0 + 1
   \   000086   A3           INC     DPTR
   \   000087   A3           INC     DPTR
   \   000088   E0           MOVX    A,@DPTR
   \   000089   F9           MOV     R1,A
   \   00008A   12....       LCALL   ??GenericApp_HandleKeys?relay
   \   00008D   809D         SJMP    ??GenericApp_ProcessEvent_2
   \                     ??GenericApp_ProcessEvent_8:
   \   00008F   A8..         MOV     R0,?V0 + 0
   \   000091   A9..         MOV     R1,?V0 + 1
   \   000093   8882         MOV     DPL,R0
   \   000095   8983         MOV     DPH,R1
   \   000097   A3           INC     DPTR
   \   000098   A3           INC     DPTR
   \   000099   E0           MOVX    A,@DPTR
   \   00009A   FA           MOV     R2,A
   \   00009B   8882         MOV     DPL,R0
   \   00009D   8983         MOV     DPH,R1
   \   00009F   A3           INC     DPTR
   \   0000A0   E0           MOVX    A,@DPTR
   \   0000A1   FB           MOV     R3,A
   \   0000A2   8882         MOV     DPL,R0
   \   0000A4   8983         MOV     DPH,R1
   \   0000A6   A3           INC     DPTR
   \   0000A7   A3           INC     DPTR
   \   0000A8   A3           INC     DPTR
   \   0000A9   E0           MOVX    A,@DPTR
   \   0000AA   8080         SJMP    ??GenericApp_ProcessEvent_2
   \                     ??GenericApp_ProcessEvent_4:
   \   0000AC                ; Setup parameters for call to function GenericApp_MessageMSGCB
   \   0000AC   AA..         MOV     R2,?V0 + 0
   \   0000AE   AB..         MOV     R3,?V0 + 1
   \   0000B0   12....       LCALL   ??GenericApp_MessageMSGCB?relay
   \   0000B3   02....       LJMP    ??GenericApp_ProcessEvent_2 & 0xFFFF
   \                     ??GenericApp_ProcessEvent_6:
   \   0000B6   85..82       MOV     DPL,?V0 + 0
   \   0000B9   85..83       MOV     DPH,?V0 + 1
   \   0000BC   A3           INC     DPTR
   \   0000BD   E0           MOVX    A,@DPTR
   \   0000BE   90....       MOV     DPTR,#GenericApp_NwkState
   \   0000C1   F0           MOVX    @DPTR,A
   \   0000C2   90....       MOV     DPTR,#GenericApp_NwkState
   \   0000C5   E0           MOVX    A,@DPTR
   \   0000C6   6409         XRL     A,#0x9
   \   0000C8   6010         JZ      ??GenericApp_ProcessEvent_9
   \   0000CA   90....       MOV     DPTR,#GenericApp_NwkState
   \   0000CD   E0           MOVX    A,@DPTR
   \   0000CE   6407         XRL     A,#0x7
   \   0000D0   6008         JZ      ??GenericApp_ProcessEvent_9
   \   0000D2   90....       MOV     DPTR,#GenericApp_NwkState
   \   0000D5   E0           MOVX    A,@DPTR
   \   0000D6   6406         XRL     A,#0x6
   \   0000D8   7011         JNZ     ??GenericApp_ProcessEvent_10
   \                     ??GenericApp_ProcessEvent_9:
   \   0000DA                ; Setup parameters for call to function osal_start_timerEx
   \   0000DA   7C30         MOV     R4,#0x30
   \   0000DC   7D75         MOV     R5,#0x75
   \   0000DE   7A01         MOV     R2,#0x1
   \   0000E0   7B00         MOV     R3,#0x0
   \   0000E2   90....       MOV     DPTR,#GenericApp_TaskID
   \   0000E5   E0           MOVX    A,@DPTR
   \   0000E6   F9           MOV     R1,A
   \   0000E7   12....       LCALL   ??osal_start_timerEx?relay
   \   0000EA   E9           MOV     A,R1
   \                     ??GenericApp_ProcessEvent_10:
   \   0000EB   02....       LJMP    ??GenericApp_ProcessEvent_2 & 0xFFFF
    409              }
    410          
    411              // return unprocessed events
    412              return (events ^ SYS_EVENT_MSG);
   \                     ??GenericApp_ProcessEvent_3:
   \   0000EE   EE           MOV     A,R6
   \   0000EF   6400         XRL     A,#0x0
   \   0000F1   FA           MOV     R2,A
   \   0000F2   EF           MOV     A,R7
   \   0000F3   6480         XRL     A,#0x80
   \   0000F5   FB           MOV     R3,A
   \   0000F6   02....       LJMP    ??GenericApp_ProcessEvent_11 & 0xFFFF
    413            }
    414          
    415            // Send a message out - This event is generated by a timer
    416            if ( events & GENERICAPP_SEND_MSG_EVT )
   \                     ??GenericApp_ProcessEvent_0:
   \   0000F9   EE           MOV     A,R6
   \   0000FA   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000FC   5067         JNC     ??GenericApp_ProcessEvent_12
    417            {
    418            	if(send_timeout_count!= 0xff) //已经发送
   \   0000FE   90....       MOV     DPTR,#send_timeout_count
   \   000101   E0           MOVX    A,@DPTR
   \   000102   64FF         XRL     A,#0xff
   \   000104   6041         JZ      ??GenericApp_ProcessEvent_13
    419            	{
    420          		if(send_timeout_count >=PACKET_SEND_TIMEOUT_COUNT) //20s 没有响应 认为超时
   \   000106   90....       MOV     DPTR,#send_timeout_count
   \   000109   E0           MOVX    A,@DPTR
   \   00010A   C3           CLR     C
   \   00010B   9402         SUBB    A,#0x2
   \   00010D   4031         JC      ??GenericApp_ProcessEvent_14
    421          		{
    422          			// 先用灯表示
    423          			HalLedSet (HAL_LED_1, HAL_LED_MODE_ON);
   \   00010F                ; Setup parameters for call to function HalLedSet
   \   00010F   7A01         MOV     R2,#0x1
   \   000111   7901         MOV     R1,#0x1
   \   000113   12....       LCALL   ??HalLedSet?relay
   \   000116   E9           MOV     A,R1
    424          			HalLedSet (HAL_LED_2, HAL_LED_MODE_ON);
   \   000117                ; Setup parameters for call to function HalLedSet
   \   000117   7A01         MOV     R2,#0x1
   \   000119   7902         MOV     R1,#0x2
   \   00011B   12....       LCALL   ??HalLedSet?relay
   \   00011E   E9           MOV     A,R1
    425          			HalLedSet (HAL_LED_3, HAL_LED_MODE_ON);
   \   00011F                ; Setup parameters for call to function HalLedSet
   \   00011F   7A01         MOV     R2,#0x1
   \   000121   7904         MOV     R1,#0x4
   \   000123   12....       LCALL   ??HalLedSet?relay
   \   000126   E9           MOV     A,R1
    426                      send_timeout_count = 0xff;
   \   000127   90....       MOV     DPTR,#send_timeout_count
   \   00012A   74FF         MOV     A,#-0x1
   \   00012C   F0           MOVX    @DPTR,A
    427          			//reboot 
    428          			Delay_ms(5000);
   \   00012D                ; Setup parameters for call to function Delay_ms
   \   00012D   7A88         MOV     R2,#-0x78
   \   00012F   7B13         MOV     R3,#0x13
   \   000131   12....       LCALL   ??Delay_ms?relay
    429          			SystemReset();
   \   000134   C2AF         CLR     0xa8.7
   \   000136   C2AF         CLR     0xa8.7
   \   000138   75C9AB       MOV     0xc9,#-0x55
   \   00013B   75C95B       MOV     0xc9,#0x5b
   \                     ??GenericApp_ProcessEvent_15:
   \   00013E   80FE         SJMP    ??GenericApp_ProcessEvent_15
    430          		}
    431          		
    432          		send_timeout_count++;
   \                     ??GenericApp_ProcessEvent_14:
   \   000140   90....       MOV     DPTR,#send_timeout_count
   \   000143   E0           MOVX    A,@DPTR
   \   000144   2401         ADD     A,#0x1
   \   000146   F0           MOVX    @DPTR,A
    433            	}
    434              // Send "the" message
    435              GenericApp_SendTheMessage();//周期性调用测温湿度并无线发送给协调器函数
   \                     ??GenericApp_ProcessEvent_13:
   \   000147                ; Setup parameters for call to function GenericApp_SendTheMessage
   \   000147   12....       LCALL   ??GenericApp_SendTheMessage?relay
    436          
    437              // Setup to send message again
    438              osal_start_timerEx( GenericApp_TaskID,
    439                                  GENERICAPP_SEND_MSG_EVT,
    440                                  GENERICAPP_SEND_MSG_TIMEOUT );//这个函数就是启动周期和设置周期长短
   \   00014A                ; Setup parameters for call to function osal_start_timerEx
   \   00014A   7C30         MOV     R4,#0x30
   \   00014C   7D75         MOV     R5,#0x75
   \   00014E   7A01         MOV     R2,#0x1
   \   000150   7B00         MOV     R3,#0x0
   \   000152   90....       MOV     DPTR,#GenericApp_TaskID
   \   000155   E0           MOVX    A,@DPTR
   \   000156   F9           MOV     R1,A
   \   000157   12....       LCALL   ??osal_start_timerEx?relay
   \   00015A   E9           MOV     A,R1
    441          
    442              // return unprocessed events
    443              return (events ^ GENERICAPP_SEND_MSG_EVT);
   \   00015B   EE           MOV     A,R6
   \   00015C   6401         XRL     A,#0x1
   \   00015E   FA           MOV     R2,A
   \   00015F   EF           MOV     A,R7
   \   000160   6400         XRL     A,#0x0
   \   000162   FB           MOV     R3,A
   \   000163   8035         SJMP    ??GenericApp_ProcessEvent_11
    444            }
    445          
    446            // 红外GPIO 中断
    447            if ( events & GENERICAPP_GPIO_MSG_EVT )
   \                     ??GenericApp_ProcessEvent_12:
   \   000165   EE           MOV     A,R6
   \   000166   5403         ANL     A,#0x3
   \   000168   6017         JZ      ??GenericApp_ProcessEvent_16
    448            {
    449            	//立即发送
    450           	collect_count = MAX_COLLECT_COUNT;
   \   00016A   90....       MOV     DPTR,#collect_count
   \   00016D   740A         MOV     A,#0xa
   \   00016F   F0           MOVX    @DPTR,A
   \   000170   A3           INC     DPTR
   \   000171   7400         MOV     A,#0x0
   \   000173   F0           MOVX    @DPTR,A
    451              GenericApp_SendTheMessage();//周期性调用测温湿度并无线发送给协调器函数
   \   000174                ; Setup parameters for call to function GenericApp_SendTheMessage
   \   000174   12....       LCALL   ??GenericApp_SendTheMessage?relay
    452              //osal_stop_timerEx(GenericApp_TaskID, uint16 event_id)
    453              // return unprocessed events
    454              return (events ^ GENERICAPP_GPIO_MSG_EVT);
   \   000177   EE           MOV     A,R6
   \   000178   6403         XRL     A,#0x3
   \   00017A   FA           MOV     R2,A
   \   00017B   EF           MOV     A,R7
   \   00017C   6400         XRL     A,#0x0
   \   00017E   FB           MOV     R3,A
   \   00017F   8019         SJMP    ??GenericApp_ProcessEvent_11
    455            }
    456              // 红外GPIO 中断控制定时器
    457            if ( events & GENERICAPP_ISR_ON_EVT )
   \                     ??GenericApp_ProcessEvent_16:
   \   000181   EE           MOV     A,R6
   \   000182   5404         ANL     A,#0x4
   \   000184   6010         JZ      ??GenericApp_ProcessEvent_17
    458            {
    459            	//立即发送
    460          	isr_on = 0;
   \   000186   90....       MOV     DPTR,#isr_on
   \   000189   7400         MOV     A,#0x0
   \   00018B   F0           MOVX    @DPTR,A
    461              return (events ^ GENERICAPP_ISR_ON_EVT);
   \   00018C   EE           MOV     A,R6
   \   00018D   6404         XRL     A,#0x4
   \   00018F   FA           MOV     R2,A
   \   000190   EF           MOV     A,R7
   \   000191   6400         XRL     A,#0x0
   \   000193   FB           MOV     R3,A
   \   000194   8004         SJMP    ??GenericApp_ProcessEvent_11
    462            }
    463            
    464          
    465            
    466          
    467            
    468          #if defined( IAR_ARMCM3_LM )
    469            // Receive a message from the RTOS queue
    470            if ( events & GENERICAPP_RTOS_MSG_EVT )
    471            {
    472              // Process message from RTOS queue
    473              GenericApp_ProcessRtosMessage();
    474          
    475              // return unprocessed events
    476              return (events ^ GENERICAPP_RTOS_MSG_EVT);
    477            }
    478          #endif
    479          
    480            // Discard unknown events
    481            return 0;
   \                     ??GenericApp_ProcessEvent_17:
   \   000196   7A00         MOV     R2,#0x0
   \   000198   7B00         MOV     R3,#0x0
   \                     ??GenericApp_ProcessEvent_11:
   \   00019A   7F04         MOV     R7,#0x4
   \   00019C   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   00019F                REQUIRE _A_IEN0
   \   00019F                REQUIRE WDCTL
    482          }
    483          
    484          /*********************************************************************
    485           * Event Generation Functions
    486           */
    487          
    488          /*********************************************************************
    489           * @fn      GenericApp_ProcessZDOMsgs()
    490           *
    491           * @brief   Process response messages
    492           *
    493           * @param   none
    494           *
    495           * @return  none
    496           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    497          static void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
   \                     GenericApp_ProcessZDOMsgs:
    498          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    499            switch ( inMsg->clusterID )
   \   000005   EA           MOV     A,R2
   \   000006   240C         ADD     A,#0xc
   \   000008   F582         MOV     DPL,A
   \   00000A   EB           MOV     A,R3
   \   00000B   3400         ADDC    A,#0x0
   \   00000D   F583         MOV     DPH,A
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F5..         MOV     ?V0 + 0,A
   \   000012   A3           INC     DPTR
   \   000013   E0           MOVX    A,@DPTR
   \   000014   F5..         MOV     ?V0 + 1,A
   \   000016   78..         MOV     R0,#?V0 + 0
   \   000018   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for GenericApp_ProcessZDOMsgs>_0`:
   \   00001B   0000         DW        0
   \   00001D   0200         DW        2
   \   00001F   0680         DW        32774
   \   000021   ....         DW        ??GenericApp_ProcessZDOMsgs_0
   \   000023   2080         DW        32800
   \   000025   ....         DW        ??GenericApp_ProcessZDOMsgs_1
   \   000027   ....         DW        ??GenericApp_ProcessZDOMsgs_2
    500            {
    501              case End_Device_Bind_rsp:
    502                if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
   \                     ??GenericApp_ProcessZDOMsgs_1:
   \   000029   EA           MOV     A,R2
   \   00002A   2413         ADD     A,#0x13
   \   00002C   F582         MOV     DPL,A
   \   00002E   EB           MOV     A,R3
   \   00002F   3400         ADDC    A,#0x0
   \   000031   F583         MOV     DPH,A
   \   000033   E0           MOVX    A,@DPTR
   \   000034   F8           MOV     R0,A
   \   000035   A3           INC     DPTR
   \   000036   E0           MOVX    A,@DPTR
   \   000037   F583         MOV     DPH,A
   \   000039   8882         MOV     DPL,R0
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   700A         JNZ     ??GenericApp_ProcessZDOMsgs_3
    503                {
    504                  // Light LED
    505                  HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   00003E                ; Setup parameters for call to function HalLedSet
   \   00003E   7A01         MOV     R2,#0x1
   \   000040   7908         MOV     R1,#0x8
   \   000042   12....       LCALL   ??HalLedSet?relay
   \   000045   E9           MOV     A,R1
   \   000046   805E         SJMP    ??GenericApp_ProcessZDOMsgs_2
    506                }
    507          #if defined( BLINK_LEDS )
    508                else
    509                {
    510                  // Flash LED to show failure
    511                  HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
   \                     ??GenericApp_ProcessZDOMsgs_3:
   \   000048                ; Setup parameters for call to function HalLedSet
   \   000048   7A04         MOV     R2,#0x4
   \   00004A   7908         MOV     R1,#0x8
   \   00004C   12....       LCALL   ??HalLedSet?relay
   \   00004F   E9           MOV     A,R1
    512                }
    513          #endif
    514                break;
   \   000050   8054         SJMP    ??GenericApp_ProcessZDOMsgs_2
    515          
    516              case Match_Desc_rsp:
    517                {
    518                  ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
   \                     ??GenericApp_ProcessZDOMsgs_0:
   \   000052                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   000052   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   000055   8A..         MOV     ?V0 + 0,R2
   \   000057   8B..         MOV     ?V0 + 1,R3
   \   000059   AE..         MOV     R6,?V0 + 0
   \   00005B   AF..         MOV     R7,?V0 + 1
    519                  if ( pRsp )
   \   00005D   EE           MOV     A,R6
   \   00005E   4F           ORL     A,R7
   \   00005F   6045         JZ      ??GenericApp_ProcessZDOMsgs_2
    520                  {
    521                    if ( pRsp->status == ZSuccess && pRsp->cnt )
   \   000061   8E82         MOV     DPL,R6
   \   000063   8F83         MOV     DPH,R7
   \   000065   E0           MOVX    A,@DPTR
   \   000066   7037         JNZ     ??GenericApp_ProcessZDOMsgs_4
   \   000068   8E82         MOV     DPL,R6
   \   00006A   8F83         MOV     DPH,R7
   \   00006C   A3           INC     DPTR
   \   00006D   A3           INC     DPTR
   \   00006E   A3           INC     DPTR
   \   00006F   E0           MOVX    A,@DPTR
   \   000070   602D         JZ      ??GenericApp_ProcessZDOMsgs_4
    522                    {
    523                      GenericApp_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
   \   000072   90....       MOV     DPTR,#GenericApp_DstAddr + 8
   \   000075   7402         MOV     A,#0x2
   \   000077   F0           MOVX    @DPTR,A
    524                      GenericApp_DstAddr.addr.shortAddr = pRsp->nwkAddr;
   \   000078   8E82         MOV     DPL,R6
   \   00007A   8F83         MOV     DPH,R7
   \   00007C   A3           INC     DPTR
   \   00007D   E0           MOVX    A,@DPTR
   \   00007E   F8           MOV     R0,A
   \   00007F   A3           INC     DPTR
   \   000080   E0           MOVX    A,@DPTR
   \   000081   F9           MOV     R1,A
   \   000082   90....       MOV     DPTR,#GenericApp_DstAddr
   \   000085   E8           MOV     A,R0
   \   000086   F0           MOVX    @DPTR,A
   \   000087   A3           INC     DPTR
   \   000088   E9           MOV     A,R1
   \   000089   F0           MOVX    @DPTR,A
    525                      // Take the first endpoint, Can be changed to search through endpoints
    526                      GenericApp_DstAddr.endPoint = pRsp->epList[0];
   \   00008A   8E82         MOV     DPL,R6
   \   00008C   8F83         MOV     DPH,R7
   \   00008E   A3           INC     DPTR
   \   00008F   A3           INC     DPTR
   \   000090   A3           INC     DPTR
   \   000091   A3           INC     DPTR
   \   000092   E0           MOVX    A,@DPTR
   \   000093   90....       MOV     DPTR,#GenericApp_DstAddr + 9
   \   000096   F0           MOVX    @DPTR,A
    527          
    528                      // Light LED
    529                      HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
   \   000097                ; Setup parameters for call to function HalLedSet
   \   000097   7A01         MOV     R2,#0x1
   \   000099   7908         MOV     R1,#0x8
   \   00009B   12....       LCALL   ??HalLedSet?relay
   \   00009E   E9           MOV     A,R1
    530                    }
    531                    osal_mem_free( pRsp );
   \                     ??GenericApp_ProcessZDOMsgs_4:
   \   00009F                ; Setup parameters for call to function osal_mem_free
   \   00009F   EE           MOV     A,R6
   \   0000A0   FA           MOV     R2,A
   \   0000A1   EF           MOV     A,R7
   \   0000A2   FB           MOV     R3,A
   \   0000A3   12....       LCALL   ??osal_mem_free?relay
    532                  }
    533                }
    534                break;
    535            }
    536          }
   \                     ??GenericApp_ProcessZDOMsgs_2:
   \   0000A6   7F02         MOV     R7,#0x2
   \   0000A8   02....       LJMP    ?BANKED_LEAVE_XDATA
    537          
    538          /*********************************************************************
    539           * @fn      GenericApp_HandleKeys
    540           *
    541           * @brief   Handles all key events for this device.
    542           *
    543           * @param   shift - true if in shift/alt.
    544           * @param   keys - bit field for key events. Valid entries:
    545           *                 HAL_KEY_SW_4
    546           *                 HAL_KEY_SW_3
    547           *                 HAL_KEY_SW_2
    548           *                 HAL_KEY_SW_1
    549           *
    550           * @return  none
    551           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    552          static void GenericApp_HandleKeys( uint8 shift, uint8 keys )
   \                     GenericApp_HandleKeys:
    553          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
   \   00000C   EA           MOV     A,R2
   \   00000D   FF           MOV     R7,A
    554            zAddrType_t dstAddr;
    555          
    556            // Shift is used to make each button/switch dual purpose.
    557            if ( shift )
   \   00000E   EE           MOV     A,R6
   \   00000F   6003         JZ      $+5
   \   000011   02....       LJMP    ??GenericApp_HandleKeys_0 & 0xFFFF
    558            {
    559              if ( keys & HAL_KEY_SW_1 )
    560              {
    561              }
    562              if ( keys & HAL_KEY_SW_2 )
    563              {
    564              }
    565              if ( keys & HAL_KEY_SW_3 )
    566              {
    567              }
    568              if ( keys & HAL_KEY_SW_4 )
    569              {
    570              }
    571            }
    572            else
    573            {
    574              if ( keys & HAL_KEY_SW_1 )
    575              {
    576                // Since SW1 isn't used for anything else in this application...
    577          #if defined( SWITCH1_BIND )
    578                // we can use SW1 to simulate SW2 for devices that only have one switch,
    579                keys |= HAL_KEY_SW_2;
    580          #elif defined( SWITCH1_MATCH )
    581                // or use SW1 to simulate SW4 for devices that only have one switch
    582                keys |= HAL_KEY_SW_4;
    583          #endif
    584              }
    585          
    586              if ( keys & HAL_KEY_SW_2 )
   \   000014   EF           MOV     A,R7
   \   000015   A2E1         MOV     C,0xE0 /* A   */.1
   \   000017   5078         JNC     ??GenericApp_HandleKeys_1
    587              {
    588                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   000019                ; Setup parameters for call to function HalLedSet
   \   000019   7A00         MOV     R2,#0x0
   \   00001B   7908         MOV     R1,#0x8
   \   00001D   12....       LCALL   ??HalLedSet?relay
   \   000020   E9           MOV     A,R1
    589          
    590                // Initiate an End Device Bind Request for the mandatory endpoint
    591                dstAddr.addrMode = Addr16Bit;
   \   000021   7408         MOV     A,#0x8
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   7402         MOV     A,#0x2
   \   000028   F0           MOVX    @DPTR,A
    592                dstAddr.addr.shortAddr = 0x0000; // Coordinator
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   7400         MOV     A,#0x0
   \   000031   F0           MOVX    @DPTR,A
   \   000032   A3           INC     DPTR
   \   000033   7400         MOV     A,#0x0
   \   000035   F0           MOVX    @DPTR,A
    593                ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(),
    594                                      GenericApp_epDesc.endPoint,
    595                                      GENERICAPP_PROFID,
    596                                      GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    597                                      GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    598                                      FALSE );
   \   000036                ; Setup parameters for call to function NLME_GetShortAddr
   \   000036   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000039   8A..         MOV     ?V0 + 0,R2
   \   00003B   8B..         MOV     ?V0 + 1,R3
   \   00003D   AC..         MOV     R4,?V0 + 0
   \   00003F   AD..         MOV     R5,?V0 + 1
   \   000041                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   000041   75..00       MOV     ?V0 + 0,#0x0
   \   000044   78..         MOV     R0,#?V0 + 0
   \   000046   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000049   75....       MOV     ?V0 + 0,#GenericApp_ClusterList & 0xff
   \   00004C   75....       MOV     ?V0 + 1,#(GenericApp_ClusterList >> 8) & 0xff
   \   00004F   78..         MOV     R0,#?V0 + 0
   \   000051   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000054   75..02       MOV     ?V0 + 0,#0x2
   \   000057   78..         MOV     R0,#?V0 + 0
   \   000059   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00005C   75....       MOV     ?V0 + 0,#GenericApp_ClusterList & 0xff
   \   00005F   75....       MOV     ?V0 + 1,#(GenericApp_ClusterList >> 8) & 0xff
   \   000062   78..         MOV     R0,#?V0 + 0
   \   000064   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000067   75..02       MOV     ?V0 + 0,#0x2
   \   00006A   78..         MOV     R0,#?V0 + 0
   \   00006C   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00006F   75..04       MOV     ?V0 + 0,#0x4
   \   000072   75..0F       MOV     ?V0 + 1,#0xf
   \   000075   78..         MOV     R0,#?V0 + 0
   \   000077   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00007A   90....       MOV     DPTR,#GenericApp_epDesc
   \   00007D   E0           MOVX    A,@DPTR
   \   00007E   F9           MOV     R1,A
   \   00007F   7409         MOV     A,#0x9
   \   000081   12....       LCALL   ?XSTACK_DISP0_8
   \   000084   AA82         MOV     R2,DPL
   \   000086   AB83         MOV     R3,DPH
   \   000088   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   00008B   7409         MOV     A,#0x9
   \   00008D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000090   E9           MOV     A,R1
    599              }
    600          
    601              if ( keys & HAL_KEY_SW_3 )
    602              {
    603              }
    604          
    605              if ( keys & HAL_KEY_SW_4 )
   \                     ??GenericApp_HandleKeys_1:
   \   000091   EF           MOV     A,R7
   \   000092   A2E3         MOV     C,0xE0 /* A   */.3
   \   000094   5066         JNC     ??GenericApp_HandleKeys_0
    606              {
    607                HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
   \   000096                ; Setup parameters for call to function HalLedSet
   \   000096   7A00         MOV     R2,#0x0
   \   000098   7908         MOV     R1,#0x8
   \   00009A   12....       LCALL   ??HalLedSet?relay
   \   00009D   E9           MOV     A,R1
    608                // Initiate a Match Description Request (Service Discovery)
    609                dstAddr.addrMode = AddrBroadcast;
   \   00009E   7408         MOV     A,#0x8
   \   0000A0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A3   740F         MOV     A,#0xf
   \   0000A5   F0           MOVX    @DPTR,A
    610                dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
   \   0000A6   85..82       MOV     DPL,?XSP + 0
   \   0000A9   85..83       MOV     DPH,?XSP + 1
   \   0000AC   74FF         MOV     A,#-0x1
   \   0000AE   F0           MOVX    @DPTR,A
   \   0000AF   A3           INC     DPTR
   \   0000B0   74FF         MOV     A,#-0x1
   \   0000B2   F0           MOVX    @DPTR,A
    611                ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    612                                  GENERICAPP_PROFID,
    613                                  GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    614                                  GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    615                                  FALSE );
   \   0000B3                ; Setup parameters for call to function ZDP_MatchDescReq
   \   0000B3   75..00       MOV     ?V0 + 0,#0x0
   \   0000B6   78..         MOV     R0,#?V0 + 0
   \   0000B8   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000BB   75....       MOV     ?V0 + 0,#GenericApp_ClusterList & 0xff
   \   0000BE   75....       MOV     ?V0 + 1,#(GenericApp_ClusterList >> 8) & 0xff
   \   0000C1   78..         MOV     R0,#?V0 + 0
   \   0000C3   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000C6   75..02       MOV     ?V0 + 0,#0x2
   \   0000C9   78..         MOV     R0,#?V0 + 0
   \   0000CB   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000CE   75....       MOV     ?V0 + 0,#GenericApp_ClusterList & 0xff
   \   0000D1   75....       MOV     ?V0 + 1,#(GenericApp_ClusterList >> 8) & 0xff
   \   0000D4   78..         MOV     R0,#?V0 + 0
   \   0000D6   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000D9   75..04       MOV     ?V0 + 0,#0x4
   \   0000DC   75..0F       MOV     ?V0 + 1,#0xf
   \   0000DF   78..         MOV     R0,#?V0 + 0
   \   0000E1   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000E4   7902         MOV     R1,#0x2
   \   0000E6   7CFF         MOV     R4,#-0x1
   \   0000E8   7DFF         MOV     R5,#-0x1
   \   0000EA   7408         MOV     A,#0x8
   \   0000EC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000EF   AA82         MOV     R2,DPL
   \   0000F1   AB83         MOV     R3,DPH
   \   0000F3   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   0000F6   7408         MOV     A,#0x8
   \   0000F8   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000FB   E9           MOV     A,R1
    616              }
    617            }
    618          }
   \                     ??GenericApp_HandleKeys_0:
   \   0000FC   7409         MOV     A,#0x9
   \   0000FE   12....       LCALL   ?DEALLOC_XSTACK8
   \   000101   7F02         MOV     R7,#0x2
   \   000103   02....       LJMP    ?BANKED_LEAVE_XDATA
    619          
    620          /*********************************************************************
    621           * LOCAL FUNCTIONS
    622           */
    623          
    624          /*********************************************************************
    625           * @fn      GenericApp_MessageMSGCB
    626           *
    627           * @brief   Data message processor callback.  This function processes
    628           *          any incoming data - probably from other devices.  So, based
    629           *          on cluster ID, perform the intended action.
    630           *
    631           * @param   none
    632           *
    633           * @return  none
    634           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    635          static void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     GenericApp_MessageMSGCB:
    636          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    637          int i;
    638            switch ( pkt->clusterId )
   \   000005   8A82         MOV     DPL,R2
   \   000007   8B83         MOV     DPH,R3
   \   000009   A3           INC     DPTR
   \   00000A   A3           INC     DPTR
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   F5..         MOV     ?V0 + 0,A
   \   000010   A3           INC     DPTR
   \   000011   E0           MOVX    A,@DPTR
   \   000012   F5..         MOV     ?V0 + 1,A
   \   000014   78..         MOV     R0,#?V0 + 0
   \   000016   12....       LCALL   ?US_SWITCH_DENSE
   \                     `?<Jumptable for GenericApp_MessageMSGCB>_0`:
   \   000019   0100         DW        1
   \   00001B   01           DB        1
   \   00001C   ....         DW        ??GenericApp_MessageMSGCB_0
   \   00001E   ....         DW        ??GenericApp_MessageMSGCB_0
   \   000020   ....         DW        ??GenericApp_MessageMSGCB_1
    639            {
    640              case GENERICAPP_HTID:
    641                // "the" message
    642          	  break;
    643          
    644              case GENERICAPP_RSPID:
    645                  //这个地方收到发送的响应
    646                  send_timeout_count =0xff; //表示收到了对端响应
   \                     ??GenericApp_MessageMSGCB_1:
   \   000022   90....       MOV     DPTR,#send_timeout_count
   \   000025   74FF         MOV     A,#-0x1
   \   000027   F0           MOVX    @DPTR,A
    647                  // test ...  
    648                  for(i=0;i<5;i++)
   \   000028   7E00         MOV     R6,#0x0
   \   00002A   7F00         MOV     R7,#0x0
   \   00002C   801F         SJMP    ??GenericApp_MessageMSGCB_2
    649                  {
    650                      HalLedSet (HAL_LED_2, HAL_LED_MODE_ON);
   \                     ??GenericApp_MessageMSGCB_3:
   \   00002E                ; Setup parameters for call to function HalLedSet
   \   00002E   7A01         MOV     R2,#0x1
   \   000030   7902         MOV     R1,#0x2
   \   000032   12....       LCALL   ??HalLedSet?relay
   \   000035   E9           MOV     A,R1
    651                      Delay_ms(100);
   \   000036                ; Setup parameters for call to function Delay_ms
   \   000036   7A64         MOV     R2,#0x64
   \   000038   7B00         MOV     R3,#0x0
   \   00003A   12....       LCALL   ??Delay_ms?relay
    652                      HalLedSet (HAL_LED_2, HAL_LED_MODE_OFF);
   \   00003D                ; Setup parameters for call to function HalLedSet
   \   00003D   7A00         MOV     R2,#0x0
   \   00003F   7902         MOV     R1,#0x2
   \   000041   12....       LCALL   ??HalLedSet?relay
   \   000044   E9           MOV     A,R1
    653                  }
   \   000045   EE           MOV     A,R6
   \   000046   2401         ADD     A,#0x1
   \   000048   FE           MOV     R6,A
   \   000049   EF           MOV     A,R7
   \   00004A   3400         ADDC    A,#0x0
   \   00004C   FF           MOV     R7,A
   \                     ??GenericApp_MessageMSGCB_2:
   \   00004D   C3           CLR     C
   \   00004E   EE           MOV     A,R6
   \   00004F   9405         SUBB    A,#0x5
   \   000051   EF           MOV     A,R7
   \   000052   9400         SUBB    A,#0x0
   \   000054   A2D2         MOV     C,0xD0 /* PSW */.2
   \   000056   65D0         XRL     A,PSW
   \   000058   33           RLC     A
   \   000059   40D3         JC      ??GenericApp_MessageMSGCB_3
    654                break;
    655            }
    656          }
   \                     ??GenericApp_MessageMSGCB_0:
   \   00005B   7F02         MOV     R7,#0x2
   \   00005D   02....       LJMP    ?BANKED_LEAVE_XDATA
    657          
    658          
    659          // Max ADC input voltage = reference voltage =>
    660          // (VDD/3) max = 1.15 V => max VDD = 3.45 V
    661          // 12 bits resolution means that max ADC value = 0x07FF = 2047 (dec)
    662          // (the ADC value is 2’s complement)
    663          // Battery voltage, VDD = adc value * (3.45 / 2047)
    664          // To avoid using a float, the below function will return the battery voltage * 100
    665          // Battery voltage * 100 = adc value * (3.75 / 2047) * 100
    666          #define XV 0.168539 // (3.45 / 2047) * 100 
    667          
    668          
    669          /************************************************************
    670          * 名称       get_adc
    671          * 功能       读取ADC通道6电压值
    672          * 入口参数   无
    673          * 出口参数   32 位 电压*100
    674          ***************获取ADC通道0电压值************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    675          uint16 App_get_adc(void)
   \                     App_get_adc:
    676          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
    677              uint32 value =0;
   \   000005   90....       MOV     DPTR,#__Constant_0
   \   000008   78..         MOV     R0,#?V0 + 0
   \   00000A   12....       LCALL   ?L_MOV_X
    678              ADCIF = 0;   //清ADC 中断标志
   \   00000D   C28D         CLR     0x88.5
    679              //采用基准电压avdd5:3.3V，通道6，启动AD转化   ADCCON3 = (0x80 | 0x10 | 0x06);
    680              ADCCON3 = (HAL_ADC_REF_115V | 0x20 | HAL_ADC_CHN_VDD3); //HAL_ADC_DEC_256
   \   00000F   75B62F       MOV     0xb6,#0x2f
    681              while ( !ADCIF )
   \                     ??App_get_adc_0:
   \   000012   A28D         MOV     C,0x88.5
   \   000014   50FC         JNC     ??App_get_adc_0
    682              {
    683                  ;  //等待AD转化结束
    684              }
    685              value = ADCH;
   \   000016   E5BB         MOV     A,0xbb
   \   000018   F5..         MOV     ?V0 + 0,A
   \   00001A   E4           CLR     A
   \   00001B   F5..         MOV     ?V0 + 1,A
   \   00001D   F5..         MOV     ?V0 + 2,A
   \   00001F   F5..         MOV     ?V0 + 3,A
    686              value = value<< 8;
   \   000021   E4           CLR     A
   \   000022   C5..         XCH     A,?V0 + 0
   \   000024   C5..         XCH     A,?V0 + 1
   \   000026   C5..         XCH     A,?V0 + 2
   \   000028   F5..         MOV     ?V0 + 3,A
    687              value |= ADCL;
   \   00002A   85BA..       MOV     ?V0 + 4,0xba
   \   00002D   E4           CLR     A
   \   00002E   F5..         MOV     ?V0 + 5,A
   \   000030   F5..         MOV     ?V0 + 6,A
   \   000032   F5..         MOV     ?V0 + 7,A
   \   000034   78..         MOV     R0,#?V0 + 0
   \   000036   79..         MOV     R1,#?V0 + 4
   \   000038   12....       LCALL   ?L_IOR
    688          	value =value >>4;
   \   00003B   7404         MOV     A,#0x4
   \   00003D   78..         MOV     R0,#?V0 + 0
   \   00003F   12....       LCALL   ?UL_SHR
    689              value =(uint16)(XV * value) + 10;  //测试下来差0.1V，10作为补偿
   \   000042   78..         MOV     R0,#?V0 + 0
   \   000044   12....       LCALL   ?UL_TO_FLT
   \   000047   90....       MOV     DPTR,#__Constant_3e2c957d
   \   00004A   78..         MOV     R0,#?V0 + 4
   \   00004C   12....       LCALL   ?L_MOV_X
   \   00004F   78..         MOV     R0,#?V0 + 0
   \   000051   79..         MOV     R1,#?V0 + 4
   \   000053   12....       LCALL   ?FLT_MUL
   \   000056   78..         MOV     R0,#?V0 + 0
   \   000058   12....       LCALL   ?FLT_TO_L
   \   00005B   E5..         MOV     A,?V0 + 0
   \   00005D   240A         ADD     A,#0xa
   \   00005F   F5..         MOV     ?V0 + 0,A
   \   000061   E5..         MOV     A,?V0 + 1
   \   000063   3400         ADDC    A,#0x0
   \   000065   F5..         MOV     ?V0 + 1,A
   \   000067   E4           CLR     A
   \   000068   F5..         MOV     ?V0 + 2,A
   \   00006A   F5..         MOV     ?V0 + 3,A
    690              return (uint16)value;
   \   00006C   AA..         MOV     R2,?V0 + 0
   \   00006E   AB..         MOV     R3,?V0 + 1
   \   000070   7F08         MOV     R7,#0x8
   \   000072   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000075                REQUIRE _A_TCON
   \   000075                REQUIRE ADCCON3
   \   000075                REQUIRE ADCH
   \   000075                REQUIRE ADCL
    691          }
    692          
    693            
    694          
    695          
    696          /*********************************************************************
    697           * @fn      GenericApp_SendTheMessage
    698           *
    699           * @brief   Send "the" message.
    700           *
    701           * @param   none
    702           *
    703           * @return  none
    704           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    705          static void GenericApp_SendTheMessage( void )
   \                     GenericApp_SendTheMessage:
    706          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 42
   \   000005   74D6         MOV     A,#-0x2a
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    707          	char strTemp[40];
    708          	//byte evalue=0;
    709              byte length=0;
   \   00000A   7E00         MOV     R6,#0x0
    710          	uint8  *pAddr = 0;
   \   00000C   75..00       MOV     ?V0 + 0,#0x0
   \   00000F   75..00       MOV     ?V0 + 1,#0x0
    711          	uint16 adc =0;
   \   000012   85..82       MOV     DPL,?XSP + 0
   \   000015   85..83       MOV     DPH,?XSP + 1
   \   000018   7400         MOV     A,#0x0
   \   00001A   F0           MOVX    @DPTR,A
   \   00001B   A3           INC     DPTR
   \   00001C   7400         MOV     A,#0x0
   \   00001E   F0           MOVX    @DPTR,A
    712          	
    713          	if(collect_count <MAX_COLLECT_COUNT)
   \   00001F   90....       MOV     DPTR,#collect_count
   \   000022   C3           CLR     C
   \   000023   E0           MOVX    A,@DPTR
   \   000024   940A         SUBB    A,#0xa
   \   000026   A3           INC     DPTR
   \   000027   E0           MOVX    A,@DPTR
   \   000028   9400         SUBB    A,#0x0
   \   00002A   A2D2         MOV     C,0xD0 /* PSW */.2
   \   00002C   65D0         XRL     A,PSW
   \   00002E   33           RLC     A
   \   00002F   5017         JNC     ??GenericApp_SendTheMessage_0
    714          	{
    715          		 HalLedSet (HAL_LED_1, HAL_LED_MODE_OFF);
   \   000031                ; Setup parameters for call to function HalLedSet
   \   000031   7A00         MOV     R2,#0x0
   \   000033   7901         MOV     R1,#0x1
   \   000035   12....       LCALL   ??HalLedSet?relay
   \   000038   E9           MOV     A,R1
    716          
    717          		collect_count++;
   \   000039   90....       MOV     DPTR,#collect_count
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   2401         ADD     A,#0x1
   \   00003F   F0           MOVX    @DPTR,A
   \   000040   A3           INC     DPTR
   \   000041   E0           MOVX    A,@DPTR
   \   000042   3400         ADDC    A,#0x0
   \   000044   F0           MOVX    @DPTR,A
    718          		return;
   \   000045   02....       LJMP    ??GenericApp_SendTheMessage_1 & 0xFFFF
    719          	}
    720          	collect_count = 0;	
   \                     ??GenericApp_SendTheMessage_0:
   \   000048   90....       MOV     DPTR,#collect_count
   \   00004B   7400         MOV     A,#0x0
   \   00004D   F0           MOVX    @DPTR,A
   \   00004E   A3           INC     DPTR
   \   00004F   7400         MOV     A,#0x0
   \   000051   F0           MOVX    @DPTR,A
    721          
    722          	
    723          	DHT11();             //获取温湿度
   \   000052                ; Setup parameters for call to function DHT11
   \   000052   12....       LCALL   ??DHT11?relay
    724          	if((wendu_shi+wendu_ge+shidu_shi+shidu_ge) ==0)
   \   000055   90....       MOV     DPTR,#wendu_shi
   \   000058   E0           MOVX    A,@DPTR
   \   000059   F8           MOV     R0,A
   \   00005A   7900         MOV     R1,#0x0
   \   00005C   90....       MOV     DPTR,#wendu_ge
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   FA           MOV     R2,A
   \   000061   7B00         MOV     R3,#0x0
   \   000063   E8           MOV     A,R0
   \   000064   2A           ADD     A,R2
   \   000065   F8           MOV     R0,A
   \   000066   E9           MOV     A,R1
   \   000067   3B           ADDC    A,R3
   \   000068   F9           MOV     R1,A
   \   000069   90....       MOV     DPTR,#shidu_shi
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   FA           MOV     R2,A
   \   00006E   7B00         MOV     R3,#0x0
   \   000070   E8           MOV     A,R0
   \   000071   2A           ADD     A,R2
   \   000072   F8           MOV     R0,A
   \   000073   E9           MOV     A,R1
   \   000074   3B           ADDC    A,R3
   \   000075   F9           MOV     R1,A
   \   000076   90....       MOV     DPTR,#shidu_ge
   \   000079   E0           MOVX    A,@DPTR
   \   00007A   FA           MOV     R2,A
   \   00007B   7B00         MOV     R3,#0x0
   \   00007D   E8           MOV     A,R0
   \   00007E   2A           ADD     A,R2
   \   00007F   F8           MOV     R0,A
   \   000080   E9           MOV     A,R1
   \   000081   3B           ADDC    A,R3
   \   000082   F9           MOV     R1,A
   \   000083   E8           MOV     A,R0
   \   000084   49           ORL     A,R1
   \   000085   700D         JNZ     ??GenericApp_SendTheMessage_2
    725          	{
    726          		// 没有读出来，置下次读
    727          		collect_count = MAX_COLLECT_COUNT;
   \   000087   90....       MOV     DPTR,#collect_count
   \   00008A   740A         MOV     A,#0xa
   \   00008C   F0           MOVX    @DPTR,A
   \   00008D   A3           INC     DPTR
   \   00008E   7400         MOV     A,#0x0
   \   000090   F0           MOVX    @DPTR,A
    728          		return;
   \   000091   02....       LJMP    ??GenericApp_SendTheMessage_1 & 0xFFFF
    729          	}
    730           
    731          
    732          	
    733          	strTemp[0] = 0x01; //SEND CODE
   \                     ??GenericApp_SendTheMessage_2:
   \   000094   7402         MOV     A,#0x2
   \   000096   12....       LCALL   ?XSTACK_DISP0_8
   \   000099   7401         MOV     A,#0x1
   \   00009B   F0           MOVX    @DPTR,A
    734          	strTemp[1] = wendu_shi*10+wendu_ge;	//tempture value
   \   00009C   90....       MOV     DPTR,#wendu_ge
   \   00009F   C082         PUSH    DPL
   \   0000A1   C083         PUSH    DPH
   \   0000A3   75F00A       MOV     B,#0xa
   \   0000A6   90....       MOV     DPTR,#wendu_shi
   \   0000A9   E0           MOVX    A,@DPTR
   \   0000AA   A4           MUL     AB
   \   0000AB   D083         POP     DPH
   \   0000AD   D082         POP     DPL
   \   0000AF   F8           MOV     R0,A
   \   0000B0   E0           MOVX    A,@DPTR
   \   0000B1   28           ADD     A,R0
   \   0000B2   C0E0         PUSH    A
   \   0000B4   7403         MOV     A,#0x3
   \   0000B6   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B9   D0E0         POP     A
   \   0000BB   F0           MOVX    @DPTR,A
    735          	strTemp[2] = shidu_shi*10+shidu_ge;//humdity value
   \   0000BC   90....       MOV     DPTR,#shidu_ge
   \   0000BF   C082         PUSH    DPL
   \   0000C1   C083         PUSH    DPH
   \   0000C3   75F00A       MOV     B,#0xa
   \   0000C6   90....       MOV     DPTR,#shidu_shi
   \   0000C9   E0           MOVX    A,@DPTR
   \   0000CA   A4           MUL     AB
   \   0000CB   D083         POP     DPH
   \   0000CD   D082         POP     DPL
   \   0000CF   F8           MOV     R0,A
   \   0000D0   E0           MOVX    A,@DPTR
   \   0000D1   28           ADD     A,R0
   \   0000D2   C0E0         PUSH    A
   \   0000D4   7404         MOV     A,#0x4
   \   0000D6   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D9   D0E0         POP     A
   \   0000DB   F0           MOVX    @DPTR,A
    736          	
    737          
    738            	if(P0_5 == 0)//如果终端的人体红外传感器周围没人活动
   \   0000DC   A285         MOV     C,0x80.5
   \   0000DE   400A         JC      ??GenericApp_SendTheMessage_3
    739          	{
    740          		strTemp[3] = 0;
   \   0000E0   7405         MOV     A,#0x5
   \   0000E2   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E5   7400         MOV     A,#0x0
   \   0000E7   F0           MOVX    @DPTR,A
   \   0000E8   8008         SJMP    ??GenericApp_SendTheMessage_4
    741          	}
    742          	else
    743            	{
    744          
    745            		strTemp[3] = 1;
   \                     ??GenericApp_SendTheMessage_3:
   \   0000EA   7405         MOV     A,#0x5
   \   0000EC   12....       LCALL   ?XSTACK_DISP0_8
   \   0000EF   7401         MOV     A,#0x1
   \   0000F1   F0           MOVX    @DPTR,A
    746            	}
    747          	length = 4; //TOTAL 4 bytes value
   \                     ??GenericApp_SendTheMessage_4:
   \   0000F2   7E04         MOV     R6,#0x4
    748          
    749          
    750          	pAddr= (uint8 *)(PXREG( 0x7800 )+HAL_INFOP_IEEE_OSET);
   \   0000F4   75..0C       MOV     ?V0 + 0,#0xc
   \   0000F7   75..78       MOV     ?V0 + 1,#0x78
    751          	osal_memcpy(strTemp+length, pAddr, 6);
   \   0000FA                ; Setup parameters for call to function osal_memcpy
   \   0000FA   75..00       MOV     ?V0 + 2,#0x0
   \   0000FD   78..         MOV     R0,#?V0 + 0
   \   0000FF   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000102   7C06         MOV     R4,#0x6
   \   000104   7D00         MOV     R5,#0x0
   \   000106   8E..         MOV     ?V0 + 0,R6
   \   000108   75..00       MOV     ?V0 + 1,#0x0
   \   00010B   7405         MOV     A,#0x5
   \   00010D   12....       LCALL   ?XSTACK_DISP0_8
   \   000110   E582         MOV     A,DPL
   \   000112   25..         ADD     A,?V0 + 0
   \   000114   FA           MOV     R2,A
   \   000115   E583         MOV     A,DPH
   \   000117   35..         ADDC    A,?V0 + 1
   \   000119   FB           MOV     R3,A
   \   00011A   12....       LCALL   ??osal_memcpy?relay
   \   00011D   7403         MOV     A,#0x3
   \   00011F   12....       LCALL   ?DEALLOC_XSTACK8
    752          
    753          	length +=6;
   \   000122   7406         MOV     A,#0x6
   \   000124   2E           ADD     A,R6
   \   000125   FE           MOV     R6,A
    754          
    755          	adc = App_get_adc();
   \   000126                ; Setup parameters for call to function App_get_adc
   \   000126   12....       LCALL   ??App_get_adc?relay
   \   000129   85..82       MOV     DPL,?XSP + 0
   \   00012C   85..83       MOV     DPH,?XSP + 1
   \   00012F   EA           MOV     A,R2
   \   000130   F0           MOVX    @DPTR,A
   \   000131   A3           INC     DPTR
   \   000132   EB           MOV     A,R3
   \   000133   F0           MOVX    @DPTR,A
    756          	osal_memcpy(strTemp+length, &adc, 2);
   \   000134                ; Setup parameters for call to function osal_memcpy
   \   000134   85..82       MOV     DPL,?XSP + 0
   \   000137   85..83       MOV     DPH,?XSP + 1
   \   00013A   A982         MOV     R1,DPL
   \   00013C   AA83         MOV     R2,DPH
   \   00013E   7B00         MOV     R3,#0x0
   \   000140   89..         MOV     ?V0 + 0,R1
   \   000142   8A..         MOV     ?V0 + 1,R2
   \   000144   8B..         MOV     ?V0 + 2,R3
   \   000146   78..         MOV     R0,#?V0 + 0
   \   000148   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00014B   7C02         MOV     R4,#0x2
   \   00014D   7D00         MOV     R5,#0x0
   \   00014F   8E..         MOV     ?V0 + 0,R6
   \   000151   75..00       MOV     ?V0 + 1,#0x0
   \   000154   7405         MOV     A,#0x5
   \   000156   12....       LCALL   ?XSTACK_DISP0_8
   \   000159   E582         MOV     A,DPL
   \   00015B   25..         ADD     A,?V0 + 0
   \   00015D   FA           MOV     R2,A
   \   00015E   E583         MOV     A,DPH
   \   000160   35..         ADDC    A,?V0 + 1
   \   000162   FB           MOV     R3,A
   \   000163   12....       LCALL   ??osal_memcpy?relay
   \   000166   7403         MOV     A,#0x3
   \   000168   12....       LCALL   ?DEALLOC_XSTACK8
    757          	length +=2;
   \   00016B   0E           INC     R6
   \   00016C   0E           INC     R6
    758          	
    759          
    760            HalLedSet (HAL_LED_1, HAL_LED_MODE_ON);
   \   00016D                ; Setup parameters for call to function HalLedSet
   \   00016D   7A01         MOV     R2,#0x1
   \   00016F   7901         MOV     R1,#0x1
   \   000171   12....       LCALL   ??HalLedSet?relay
   \   000174   E9           MOV     A,R1
    761           
    762            if ( AF_DataRequest( &GenericApp_DstAddr, &GenericApp_epDesc,
    763                                 GENERICAPP_HTID,
    764                                 length,
    765                                 (uchar*)strTemp,
    766                                 &GenericApp_TransID,
    767                                 AF_DISCV_ROUTE,
    768                                 AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
   \   000175                ; Setup parameters for call to function AF_DataRequest
   \   000175   75..1E       MOV     ?V0 + 0,#0x1e
   \   000178   78..         MOV     R0,#?V0 + 0
   \   00017A   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00017D   75....       MOV     ?V0 + 0,#GenericApp_TransID & 0xff
   \   000180   75....       MOV     ?V0 + 1,#(GenericApp_TransID >> 8) & 0xff
   \   000183   78..         MOV     R0,#?V0 + 0
   \   000185   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000188   7405         MOV     A,#0x5
   \   00018A   12....       LCALL   ?XSTACK_DISP0_8
   \   00018D   8582..       MOV     ?V0 + 0,DPL
   \   000190   8583..       MOV     ?V0 + 1,DPH
   \   000193   78..         MOV     R0,#?V0 + 0
   \   000195   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000198   8E..         MOV     ?V0 + 0,R6
   \   00019A   75..00       MOV     ?V0 + 1,#0x0
   \   00019D   78..         MOV     R0,#?V0 + 0
   \   00019F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001A2   75..01       MOV     ?V0 + 0,#0x1
   \   0001A5   75..00       MOV     ?V0 + 1,#0x0
   \   0001A8   78..         MOV     R0,#?V0 + 0
   \   0001AA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001AD   7920         MOV     R1,#0x20
   \   0001AF   7C..         MOV     R4,#GenericApp_epDesc & 0xff
   \   0001B1   7D..         MOV     R5,#(GenericApp_epDesc >> 8) & 0xff
   \   0001B3   7A..         MOV     R2,#GenericApp_DstAddr & 0xff
   \   0001B5   7B..         MOV     R3,#(GenericApp_DstAddr >> 8) & 0xff
   \   0001B7   12....       LCALL   ??AF_DataRequest?relay
   \   0001BA   7409         MOV     A,#0x9
   \   0001BC   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001BF   E9           MOV     A,R1
   \   0001C0   7006         JNZ     ??GenericApp_SendTheMessage_5
    769            {
    770            		send_timeout_count = 0; //start timeout count
   \   0001C2   90....       MOV     DPTR,#send_timeout_count
   \   0001C5   7400         MOV     A,#0x0
   \   0001C7   F0           MOVX    @DPTR,A
    771            }
    772            else
    773            {
    774              // Error occurred in request to send.
    775            }
    776            		  HalLedSet (HAL_LED_2, HAL_LED_MODE_OFF);
   \                     ??GenericApp_SendTheMessage_5:
   \   0001C8                ; Setup parameters for call to function HalLedSet
   \   0001C8   7A00         MOV     R2,#0x0
   \   0001CA   7902         MOV     R1,#0x2
   \   0001CC   12....       LCALL   ??HalLedSet?relay
   \   0001CF   E9           MOV     A,R1
    777            send_timeout_count = 0; //start timeout count
   \   0001D0   90....       MOV     DPTR,#send_timeout_count
   \   0001D3   7400         MOV     A,#0x0
   \   0001D5   F0           MOVX    @DPTR,A
    778            
    779          }
   \                     ??GenericApp_SendTheMessage_1:
   \   0001D6   742A         MOV     A,#0x2a
   \   0001D8   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001DB   7F03         MOV     R7,#0x3
   \   0001DD   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   0001E0                REQUIRE _A_P0

   \                                 In  segment INTVEC, offset 0x6b, root
   \                     `??P0_ISR??INTVEC 107`:
   \   00006B   02....       LJMP       (P0_ISR)

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for collect_count>`:
   \   000000   0900         DW 9

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for send_timeout_count>`:
   \   000000   FF           DB 255

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_ProcessZDOMsgs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_ProcessZDOMsgs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_HandleKeys?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_HandleKeys

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??App_get_adc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    App_get_adc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_SendTheMessage?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_SendTheMessage

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant "GenericApp">`:
   \   000000   47656E65     DB "GenericApp"
   \            72696341
   \            707000  

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_0:
   \   000000   00000000     DD 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e2c957d:
   \   000000   7D952C3E     DD 3E2C957DH
    780          
    781          #if defined( IAR_ARMCM3_LM )
    782          /*********************************************************************
    783           * @fn      GenericApp_ProcessRtosMessage
    784           *
    785           * @brief   Receive message from RTOS queue, send response back.
    786           *
    787           * @param   none
    788           *
    789           * @return  none
    790           */
    791          static void GenericApp_ProcessRtosMessage( void )
    792          {
    793            osalQueue_t inMsg;
    794          
    795            if ( osal_queue_receive( OsalQueue, &inMsg, 0 ) == pdPASS )
    796            {
    797              uint8 cmndId = inMsg.cmnd;
    798              uint32 counter = osal_build_uint32( inMsg.cbuf, 4 );
    799          
    800              switch ( cmndId )
    801              {
    802                case CMD_INCR:
    803                  counter += 1;  /* Increment the incoming counter */
    804                                 /* Intentionally fall through next case */
    805          
    806                case CMD_ECHO:
    807                {
    808                  userQueue_t outMsg;
    809          
    810                  outMsg.resp = RSP_CODE | cmndId;  /* Response ID */
    811                  osal_buffer_uint32( outMsg.rbuf, counter );    /* Increment counter */
    812                  osal_queue_send( UserQueue1, &outMsg, 0 );  /* Send back to UserTask */
    813                  break;
    814                }
    815                
    816                default:
    817                  break;  /* Ignore unknown command */    
    818              }
    819            }
    820          }
    821          #endif
    822          
    823          /*********************************************************************
    824           */

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     App_get_adc                        0      0     69
     GenericApp_HandleKeys              0      0     40
       -> HalLedSet                     0      0     38
       -> NLME_GetShortAddr             0      0     38
       -> ZDP_EndDeviceBindReq          0      0     56
       -> HalLedSet                     0      0     38
       -> ZDP_MatchDescReq              0      0     54
     GenericApp_Init                    0      0      9
       -> DHT11                         0      0     18
       -> afRegister                    0      0     18
       -> RegisterForKeys               0      0     18
       -> HalLcdWriteString             0      0     18
       -> ZDO_RegisterForZDOMsg         0      0     18
       -> ZDO_RegisterForZDOMsg         0      0     18
       -> osal_start_timerEx            0      0     18
     GenericApp_MessageMSGCB            0      0     22
       -> HalLedSet                     0      0     20
       -> Delay_ms                      0      0     20
       -> HalLedSet                     0      0     20
     GenericApp_ProcessEvent            0      0     12
       -> osal_msg_receive              0      0     24
       -> osal_msg_deallocate           0      0     24
       -> osal_msg_receive              0      0     24
       -> GenericApp_ProcessZDOMsgs     0      0     24
       -> GenericApp_HandleKeys         0      0     24
       -> GenericApp_MessageMSGCB       0      0     24
       -> osal_start_timerEx            0      0     24
       -> HalLedSet                     0      0     24
       -> HalLedSet                     0      0     24
       -> HalLedSet                     0      0     24
       -> Delay_ms                      0      0     24
       -> GenericApp_SendTheMessage     0      0     24
       -> osal_start_timerEx            0      0     24
       -> GenericApp_SendTheMessage     0      0     24
     GenericApp_ProcessZDOMsgs          0      0     22
       -> HalLedSet                     0      0     20
       -> HalLedSet                     0      0     20
       -> ZDO_ParseEPListRsp            0      0     20
       -> HalLedSet                     0      0     20
       -> osal_mem_free                 0      0     20
     GenericApp_SendTheMessage          2      0     74
       -> HalLedSet                     0      0    106
       -> DHT11                         0      0    106
       -> osal_memcpy                   0      0    112
       -> App_get_adc                   0      0    106
       -> osal_memcpy                   0      0    112
       -> HalLedSet                     0      0    106
       -> AF_DataRequest                0      0    124
       -> HalLedSet                     0      0    106
     P0_ISR                             0      0     14
       -> osal_start_timerEx            0      0     28
       -> osal_start_timerEx            0      0     28


   Segment part sizes:

     Function/Label                        Bytes
     --------------                        -----
     _A_P0                                    1
     _A_TCON                                  1
     P0IFG                                    1
     PICTL                                    1
     _A_P1                                    1
     _A_IEN0                                  1
     P0IEN                                    1
     ADCCON3                                  1
     _A_IEN1                                  1
     ADCL                                     1
     ADCH                                     1
     _A_IRCON                                 1
     WDCTL                                    1
     APCFG                                    1
     P0SEL                                    1
     P0DIR                                    1
     P1DIR                                    1
     GenericApp_ClusterList                   4
     GenericApp_SimpleDesc                   12
     GenericApp_epDesc                        6
     GenericApp_TaskID                        1
     GenericApp_NwkState                      1
     GenericApp_TransID                       1
     GenericApp_DstAddr                      12
     collect_count                            2
     send_timeout_count                       1
     isr_on                                   1
     P0_ISR                                  63
     GenericApp_Init                        186
     GenericApp_ProcessEvent                415
     GenericApp_ProcessZDOMsgs              171
     GenericApp_HandleKeys                  262
     GenericApp_MessageMSGCB                 96
     App_get_adc                            117
     GenericApp_SendTheMessage              480
     ??P0_ISR??INTVEC 107                     3
     ?<Initializer for collect_count>         2
     ?<Initializer for send_timeout_count>    1
     ??GenericApp_Init?relay                  6
     ??GenericApp_ProcessEvent?relay          6
     ??GenericApp_ProcessZDOMsgs?relay        6
     ??GenericApp_HandleKeys?relay            6
     ??GenericApp_MessageMSGCB?relay          6
     ??App_get_adc?relay                      6
     ??GenericApp_SendTheMessage?relay        6
     ?<Constant "GenericApp">                11
     __Constant_0                             4
     __Constant_3e2c957d                      4

 
 1 727 bytes in segment BANKED_CODE
    42 bytes in segment BANK_RELAYS
     3 bytes in segment INTVEC
    63 bytes in segment NEAR_CODE
    17 bytes in segment SFR_AN
     3 bytes in segment XDATA_I
     3 bytes in segment XDATA_ID
    35 bytes in segment XDATA_ROM_C
    22 bytes in segment XDATA_Z
 
 1 835 bytes of CODE  memory (+  3 bytes shared)
    27 bytes of CONST memory (+  8 bytes shared)
     0 bytes of DATA  memory (+ 17 bytes shared)
    25 bytes of XDATA memory

Errors: none
Warnings: none
